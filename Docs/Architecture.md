# F__K_UI æ¶æ„æ¦‚è§ˆ

## ç®€ä»‹

F__K_UI æ˜¯ä¸€ä¸ªå— WPF å¯å‘çš„ç°ä»£ C++ UI æ¡†æ¶ï¼Œæä¾›äº†ä¸€ä¸ªå®Œæ•´çš„ç³»ç»Ÿæ¥æ„å»ºå…·æœ‰å£°æ˜å¼ UIã€æ•°æ®ç»‘å®šå’Œçµæ´»å¸ƒå±€çš„æ¡Œé¢åº”ç”¨ç¨‹åºã€‚

## æ¨¡å—ç»„ç»‡

æ¡†æ¶ç»„ç»‡ä¸º 5 ä¸ªä¸»è¦æ¨¡å—ï¼š

```
F__K_UI/
â”œâ”€â”€ app/        åº”ç”¨ç¨‹åºç”Ÿå‘½å‘¨æœŸå’Œçª—å£ç®¡ç†
â”œâ”€â”€ binding/    ä¾èµ–å±æ€§å’Œæ•°æ®ç»‘å®š
â”œâ”€â”€ core/       æ ¸å¿ƒåŸºç¡€è®¾æ–½å’Œå·¥å…·
â”œâ”€â”€ render/     æ¸²æŸ“ç®¡çº¿å’Œå›¾å½¢
â””â”€â”€ ui/         ç”¨æˆ·ç•Œé¢å…ƒç´ å’Œæ§ä»¶
```

## æ•´ä½“æ¶æ„å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     åº”ç”¨ç¨‹åºå±‚                                â”‚
â”‚                  (app::Application, Window)                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      UI å±‚                                    â”‚
â”‚         (Controls, Panels, Shapes, Visual Tree)              â”‚
â”‚  Button, TextBlock, Border, Image, StackPanel, Grid, ç­‰      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    ç»‘å®šå±‚                                     â”‚
â”‚     (ä¾èµ–å±æ€§ã€æ•°æ®ç»‘å®šã€éªŒè¯)                                  â”‚
â”‚   DependencyObject, Binding, BindingExpression, ç­‰           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    æ¸²æŸ“å±‚                                     â”‚
â”‚        (æ¸²æŸ“ç®¡çº¿ã€OpenGL åç«¯ã€æ–‡æœ¬)                            â”‚
â”‚      Renderer, GlRenderer, RenderBackend, TextRenderer      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     æ ¸å¿ƒå±‚                                    â”‚
â”‚          (çº¿ç¨‹ã€äº‹ä»¶ã€æ—¶é—´ã€æ—¥å¿—)                               â”‚
â”‚         Dispatcher, Event, Clock, Timer, Logger             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ç±»å±‚æ¬¡ç»“æ„å’Œå…³ç³»

### å®Œæ•´ç±»å±‚æ¬¡ç»“æ„

```
æ ¸å¿ƒåŸºç¡€è®¾æ–½
â””â”€â”€ core::Dispatcher (çº¿ç¨‹å®‰å…¨æ¶ˆæ¯å¾ªç¯)
    â””â”€â”€ core::DispatcherOperation (é˜Ÿåˆ—æ“ä½œ)
â””â”€â”€ core::Event<T> (ç±»å‹å®‰å…¨äº‹ä»¶ç³»ç»Ÿ)
â””â”€â”€ core::Clock (æ—¶é—´è·Ÿè¸ª)
â””â”€â”€ core::Timer (å®šæ—¶å™¨å®ç°)
â””â”€â”€ core::Logger (æ—¥å¿—æ¥å£)
    â”œâ”€â”€ core::ConsoleLogger
    â”œâ”€â”€ core::NullLogger
    â””â”€â”€ core::LoggerManager

ç»‘å®šç³»ç»Ÿ
â””â”€â”€ binding::DependencyObject (å±æ€§ç³»ç»ŸåŸºç±»)
    â”œâ”€â”€ binding::ObservableObject (å¸¦ INPC çš„ ViewModel åŸºç±»)
    â””â”€â”€ ui::Visual (è§†è§‰æ ‘åŸºç±»)
        â””â”€â”€ ui::UIElement (äº¤äº’å…ƒç´ )
            â””â”€â”€ ui::FrameworkElement<Derived> (å¸ƒå±€æ”¯æŒ)
                â”œâ”€â”€ ui::Control<Derived> (å¯æ¨¡æ¿åŒ–æ§ä»¶)
                â”‚   â”œâ”€â”€ ui::ContentControl<Derived> (å•å†…å®¹)
                â”‚   â”‚   â”œâ”€â”€ ui::Button
                â”‚   â”‚   â””â”€â”€ ui::Window
                â”‚   â””â”€â”€ ui::ItemsControl<Derived> (å¤šé¡¹ç›®)
                â”œâ”€â”€ ui::Panel<Derived> (å¤šå­å…ƒç´ å®¹å™¨)
                â”‚   â”œâ”€â”€ ui::StackPanel
                â”‚   â””â”€â”€ ui::Grid
                â”œâ”€â”€ ui::Shape (çŸ¢é‡å›¾å½¢åŸºç±»)
                â”‚   â”œâ”€â”€ ui::Rectangle
                â”‚   â””â”€â”€ ui::Ellipse
                â”œâ”€â”€ ui::TextBlock (æ–‡æœ¬æ˜¾ç¤º)
                â”œâ”€â”€ ui::Border (è£…é¥°å™¨)
                â””â”€â”€ ui::Image (ä½å›¾æ˜¾ç¤º)

â””â”€â”€ binding::DependencyProperty (å±æ€§å…ƒæ•°æ®)
â””â”€â”€ binding::Binding (ç»‘å®šé…ç½®)
    â””â”€â”€ binding::TemplateBinding (æ¨¡æ¿ç»‘å®š)
â””â”€â”€ binding::MultiBinding (å¤šæºç»‘å®š)
â””â”€â”€ binding::BindingExpression (æ´»åŠ¨ç»‘å®š)
â””â”€â”€ binding::MultiBindingExpression (æ´»åŠ¨å¤šç»‘å®š)
â””â”€â”€ binding::BindingContext (ç®¡ç†å¯¹è±¡çš„ç»‘å®š)
â””â”€â”€ binding::BindingPath (å±æ€§è·¯å¾„è§£æå™¨)
â””â”€â”€ binding::PropertyStore (å€¼å­˜å‚¨)
â””â”€â”€ binding::PropertyAccessorRegistry (å±æ€§è®¿é—®å™¨)
â””â”€â”€ binding::RelativeSource (ç›¸å¯¹ç»‘å®šæº)

å€¼è½¬æ¢å™¨
â””â”€â”€ binding::IValueConverter (è½¬æ¢å™¨æ¥å£)
    â”œâ”€â”€ binding::DefaultValueConverter
    â””â”€â”€ binding::BooleanToStringConverter
â””â”€â”€ binding::IMultiValueConverter (å¤šå€¼è½¬æ¢å™¨)

éªŒè¯
â””â”€â”€ binding::ValidationRule (éªŒè¯åŸºç±»)
    â”œâ”€â”€ binding::EmailValidationRule
    â”œâ”€â”€ binding::NotEmptyValidationRule
    â”œâ”€â”€ binding::RangeValidationRule
    â”œâ”€â”€ binding::StringLengthValidationRule
    â””â”€â”€ binding::FunctionValidationRule

æ¥å£
â””â”€â”€ binding::INotifyPropertyChanged (å±æ€§å˜æ›´é€šçŸ¥æ¥å£)
â””â”€â”€ binding::INotifyDataErrorInfo (é”™è¯¯é€šçŸ¥æ¥å£)

æ¸²æŸ“ç³»ç»Ÿ
â””â”€â”€ render::IRenderer (æ¸²æŸ“å™¨æ¥å£)
    â””â”€â”€ render::GlRenderer (OpenGL å®ç°)
â””â”€â”€ render::Renderer (ä¸»æ¸²æŸ“å™¨)
â””â”€â”€ render::RenderBackend (å¹³å°æŠ½è±¡)
    â””â”€â”€ render::OpenGLRenderBackend
â””â”€â”€ render::RenderContext (æ¸²æŸ“ä¸Šä¸‹æ–‡)
â””â”€â”€ render::RenderHost (æ¸²æŸ“å®¿ä¸»ç®¡ç†)
â””â”€â”€ render::RenderScene (åœºæ™¯ç®¡ç†)
â””â”€â”€ render::RenderTreeBuilder (æ„å»ºæ¸²æŸ“æ ‘)
â””â”€â”€ render::RenderCommandBuffer (å‘½ä»¤ç¼“å†²)
â””â”€â”€ render::RenderList (æ¸²æŸ“åˆ—è¡¨ç®¡ç†)
â””â”€â”€ render::TextRenderer (FreeType æ–‡æœ¬æ¸²æŸ“)
â””â”€â”€ render::ColorUtils (é¢œè‰²å·¥å…·)

UI å…ƒç´  - è¾“å…¥ç®¡ç†
â””â”€â”€ ui::InputManager (è¾“å…¥äº‹ä»¶è·¯ç”±)
â””â”€â”€ ui::FocusManager (ç„¦ç‚¹ç®¡ç†)
â””â”€â”€ ui::RoutedEvent (è·¯ç”±äº‹ä»¶ç³»ç»Ÿ)

UI å…ƒç´  - é›†åˆ
â””â”€â”€ ui::VisualCollection (è§†è§‰å­å…ƒç´ é›†åˆ)
â””â”€â”€ ui::ObservableCollection<T> (å¯è§‚å¯Ÿé›†åˆ)

UI å…ƒç´  - å˜æ¢
â””â”€â”€ ui::Transform (å˜æ¢åŸºç±»)
    â”œâ”€â”€ ui::TranslateTransform (å¹³ç§»)
    â”œâ”€â”€ ui::ScaleTransform (ç¼©æ”¾)
    â”œâ”€â”€ ui::RotateTransform (æ—‹è½¬)
    â”œâ”€â”€ ui::SkewTransform (å€¾æ–œ)
    â”œâ”€â”€ ui::MatrixTransform (çŸ©é˜µ)
    â””â”€â”€ ui::TransformGroup (ç»„åˆ)

UI å…ƒç´  - æ ·å¼å’Œæ¨¡æ¿
â””â”€â”€ ui::Style (æ ·å¼å®šä¹‰)
â””â”€â”€ ui::Setter (å±æ€§è®¾ç½®å™¨)
â””â”€â”€ ui::SetterCollection (è®¾ç½®å™¨é›†åˆ)
â””â”€â”€ ui::FrameworkTemplate (æ¨¡æ¿åŸºç±»)
    â”œâ”€â”€ ui::ControlTemplate (æ§ä»¶æ¨¡æ¿)
    â””â”€â”€ ui::DataTemplate (æ•°æ®æ¨¡æ¿)
â””â”€â”€ ui::ResourceDictionary (èµ„æºå­˜å‚¨)

UI å…ƒç´  - æ¸²æŸ“
â””â”€â”€ ui::DrawCommand (ç»˜å›¾å‘½ä»¤)

åº”ç”¨ç¨‹åº
â””â”€â”€ app::Application (åº”ç”¨ç¨‹åºå•ä¾‹)
```

## å®ç°çŠ¶æ€å›¾ä¾‹

- âœ… **å·²å®ç°** - å®Œå…¨å®ç°å¹¶æµ‹è¯•
- ğŸ”§ **éœ€æ‰©å……** - å·²å®ç°ä½†éœ€è¦å¢å¼º
- âš ï¸ **å‡å®ç°** - å­˜æ ¹/å ä½ç¬¦å®ç°
- âŒ **æœªå®ç°** - å°šæœªå®ç°

## æ¨¡å—èŒè´£

### App æ¨¡å—

**ç›®çš„**ï¼šåº”ç”¨ç¨‹åºç”Ÿå‘½å‘¨æœŸå’Œé¡¶çº§çª—å£ç®¡ç†

**ç±»ï¼ˆ1 ä¸ªï¼‰**ï¼š
- âœ… `Application` - åº”ç”¨ç¨‹åºå•ä¾‹ã€çª—å£åˆ›å»ºã€æ¶ˆæ¯å¾ªç¯

**èŒè´£**ï¼š
- åº”ç”¨ç¨‹åºåˆå§‹åŒ–å’Œå…³é—­
- çª—å£åˆ›å»ºå’Œç®¡ç†
- æ¶ˆæ¯æ³µå’Œäº‹ä»¶å¾ªç¯
- åº”ç”¨ç¨‹åºçº§èµ„æº

**å…³é”®ä¾èµ–**ï¼šCore (Dispatcher)ã€UI (Window)

---

### Core æ¨¡å—

**ç›®çš„**ï¼šåŸºç¡€è®¾æ–½å’Œå·¥å…·

**ç±»ï¼ˆ9 ä¸ªï¼‰**ï¼š
- âœ… `Dispatcher` - çº¿ç¨‹å®‰å…¨æ¶ˆæ¯è°ƒåº¦å’Œè°ƒç”¨
- âœ… `DispatcherOperation` - è¡¨ç¤ºé˜Ÿåˆ—æ“ä½œ
- âœ… `Event<T>` - å¸¦è¿æ¥çš„ç±»å‹å®‰å…¨äº‹ä»¶ç³»ç»Ÿ
- âœ… `Clock` - å¸§æ—¶é—´è·Ÿè¸ªå’Œè®¡æ—¶
- âœ… `Timer` - å¸¦å›è°ƒçš„å®šæ—¶å™¨å®ç°
- âœ… `Logger` - æ—¥å¿—æ¥å£
- âœ… `LoggerManager` - ç®¡ç†æ—¥å¿—å®ä¾‹
- âœ… `ConsoleLogger` - æ§åˆ¶å°è¾“å‡ºæ—¥å¿—
- âœ… `NullLogger` - æ— æ“ä½œæ—¥å¿—

**èŒè´£**ï¼š
- çº¿ç¨‹åŒæ­¥å’Œç¼–ç»„
- äº‹ä»¶è®¢é˜…å’Œé€šçŸ¥
- æ—¶é—´æµ‹é‡å’Œå¸§è®¡æ—¶
- æ—¥å¿—åŸºç¡€è®¾æ–½

**å…³é”®ä¾èµ–**ï¼šæ— ï¼ˆåŸºç¡€å±‚ï¼‰

---

### Binding æ¨¡å—

**ç›®çš„**ï¼šä¾èµ–å±æ€§ç³»ç»Ÿå’Œæ•°æ®ç»‘å®šåŸºç¡€è®¾æ–½

**ç±»ï¼ˆ25 ä¸ªï¼‰**ï¼š

**æ ¸å¿ƒç»‘å®š**ï¼š
- âœ… `DependencyObject` - å…·æœ‰ä¾èµ–å±æ€§æ”¯æŒçš„åŸºç±»ï¼ˆ120%ï¼‰
- âœ… `DependencyProperty` - å±æ€§å…ƒæ•°æ®å’Œæ³¨å†Œï¼ˆ110%ï¼‰
- âœ… `Binding` - æ•°æ®ç»‘å®šé…ç½®
- âœ… `BindingExpression` - æ´»åŠ¨ç»‘å®šå®ä¾‹ï¼ˆ115%ï¼‰
- âœ… `BindingContext` - ç®¡ç†å¯¹è±¡çš„ç»‘å®š
- âœ… `BindingPath` - å±æ€§è·¯å¾„è§£æå’Œè§£æ
- âœ… `MultiBinding` - å¤šæºç»‘å®šé…ç½®
- âœ… `MultiBindingExpression` - æ´»åŠ¨å¤šç»‘å®šå®ä¾‹
- ğŸ”§ `TemplateBinding` - æ¨¡æ¿å±æ€§ç»‘å®šï¼ˆéœ€è¦å¢å¼ºï¼‰
- ğŸ”§ `RelativeSource` - ç›¸å¯¹ç»‘å®šæºè§„èŒƒï¼ˆéœ€è¦å¢å¼ºï¼‰

**å€¼è½¬æ¢**ï¼š
- âœ… `IValueConverter` - å€¼è½¬æ¢å™¨æ¥å£
- ğŸ”§ `IMultiValueConverter` - å¤šå€¼è½¬æ¢å™¨æ¥å£ï¼ˆåŸºæœ¬å®ç°ï¼‰
- âœ… `DefaultValueConverter` - é»˜è®¤ç±»å‹è½¬æ¢
- âœ… `BooleanToStringConverter` - å¸ƒå°”åˆ°å­—ç¬¦ä¸²è½¬æ¢

**éªŒè¯**ï¼š
- âœ… `ValidationRule` - éªŒè¯è§„åˆ™åŸºç±»
- âœ… `EmailValidationRule` - ç”µå­é‚®ä»¶æ ¼å¼éªŒè¯
- âœ… `NotEmptyValidationRule` - éç©ºéªŒè¯
- âœ… `RangeValidationRule` - æ•°å€¼èŒƒå›´éªŒè¯
- âœ… `StringLengthValidationRule` - å­—ç¬¦ä¸²é•¿åº¦éªŒè¯
- âœ… `FunctionValidationRule` - è‡ªå®šä¹‰å‡½æ•°éªŒè¯

**æ¥å£**ï¼š
- âœ… `INotifyPropertyChanged` - å±æ€§å˜æ›´é€šçŸ¥æ¥å£
- âœ… `INotifyDataErrorInfo` - é”™è¯¯é€šçŸ¥æ¥å£

**ViewModels**ï¼š
- âœ… `ObservableObject` - ViewModel åŸºç±»

**å­˜å‚¨**ï¼š
- âœ… `PropertyStore` - å±æ€§å€¼å­˜å‚¨
- âœ… `PropertyAccessorRegistry` - å±æ€§è®¿é—®å™¨æ³¨å†Œ

**èŒè´£**ï¼š
- å±æ€§å˜æ›´é€šçŸ¥å’Œä¼ æ’­
- UI å’Œæ•°æ®æºä¹‹é—´çš„æ•°æ®ç»‘å®š
- å€¼è½¬æ¢å’ŒéªŒè¯
- å±æ€§å€¼å­˜å‚¨å’Œä¼˜å…ˆçº§
- é€»è¾‘æ ‘å’Œ DataContext ç»§æ‰¿

**å…³é”®ä¾èµ–**ï¼šCore (Event, Dispatcher)

---

### Render æ¨¡å—

**ç›®çš„**ï¼šæ¸²æŸ“ç®¡çº¿å’Œå›¾å½¢åç«¯

**ç±»ï¼ˆ13 ä¸ªï¼‰**ï¼š
- âœ… `IRenderer` - æ¸²æŸ“å™¨æ¥å£
- âœ… `Renderer` - ä¸»æ¸²æŸ“å™¨å®ç°ï¼ˆ115%ï¼‰
- âœ… `GlRenderer` - OpenGL ç‰¹å®šæ¸²æŸ“å™¨
- âœ… `RenderBackend` - å¹³å°æŠ½è±¡ï¼ˆ100%ï¼‰
- âœ… `OpenGLRenderBackend` - OpenGL åç«¯å®ç°
- âœ… `RenderContext` - æ¸²æŸ“ä¸Šä¸‹æ–‡å’ŒçŠ¶æ€
- âœ… `RenderHost` - ç®¡ç†æ¸²æŸ“è¡¨é¢
- âœ… `RenderScene` - åœºæ™¯å›¾ç®¡ç†
- âœ… `RenderTreeBuilder` - ä»è§†è§‰æ ‘æ„å»ºæ¸²æŸ“æ ‘ï¼ˆ110%ï¼‰
- ğŸ”§ `RenderCommandBuffer` - æ¸²æŸ“å‘½ä»¤ç¼“å†²ï¼ˆéœ€è¦æ‰¹å¤„ç†ï¼‰
- ğŸ”§ `RenderList` - ç®¡ç†æ¸²æŸ“å‘½ä»¤åˆ—è¡¨ï¼ˆéœ€è¦ä¼˜åŒ–ï¼‰
- âœ… `TextRenderer` - ä½¿ç”¨ FreeType çš„æ–‡æœ¬æ¸²æŸ“
- âœ… `ColorUtils` - é¢œè‰²æ“ä½œå·¥å…·

**èŒè´£**ï¼š
- è§†è§‰æ ‘åˆ°æ¸²æŸ“æ ‘çš„è½¬æ¢
- OpenGL æ¸²æŸ“å’ŒçŠ¶æ€ç®¡ç†
- ä½¿ç”¨å­—ä½“çš„æ–‡æœ¬æ¸²æŸ“
- å‘½ä»¤ç¼“å†²å’Œæ‰¹å¤„ç†
- å¹³å°æŠ½è±¡

**å…³é”®ä¾èµ–**ï¼šCoreï¼ˆæ¸²æŸ“çº§åˆ«æ²¡æœ‰ç›´æ¥ UI ä¾èµ–ï¼‰

---

### UI æ¨¡å—

**ç›®çš„**ï¼šç”¨æˆ·ç•Œé¢å…ƒç´ ã€æ§ä»¶å’Œè§†è§‰æ ‘

**ç±»ï¼ˆ50+ ä¸ªï¼‰**ï¼š

**åŸºç±»ï¼ˆ7 ä¸ªï¼‰**ï¼š
- âœ… `Visual` - è§†è§‰æ ‘èŠ‚ç‚¹åŸºç±»ï¼ˆ100%ï¼‰
- âœ… `UIElement` - å¸¦è¾“å…¥å’Œå¸ƒå±€çš„äº¤äº’å…ƒç´ ï¼ˆ110%ï¼‰
- âœ… `FrameworkElement<Derived>` - å¸¦å¤§å°çš„å¸ƒå±€æ„ŸçŸ¥å…ƒç´ ï¼ˆ115%ï¼‰
- âœ… `Control<Derived>` - å¯æ¨¡æ¿åŒ–æ§ä»¶åŸºç±»ï¼ˆ95%ï¼‰
- âœ… `ContentControl<Derived>` - å•å†…å®¹å®¿ä¸»ï¼ˆ95%ï¼‰
- âœ… `Panel<Derived>` - å¤šå­å…ƒç´ å®¹å™¨åŸºç±»ï¼ˆ95%ï¼‰
- ğŸ”§ `ItemsControl<Derived>` - é¡¹ç›®é›†åˆæ§ä»¶ï¼ˆ85% - éœ€è¦å®¹å™¨ç”Ÿæˆï¼‰

**å¸ƒå±€å®¹å™¨ï¼ˆ2 ä¸ªï¼‰**ï¼š
- âœ… `StackPanel` - é¡ºåºå¸ƒå±€ï¼ˆæ°´å¹³/å‚ç›´ï¼‰ï¼ˆ100%ï¼‰
- âœ… `Grid` - åŸºäºç½‘æ ¼çš„å¸ƒå±€ï¼ˆ95%ï¼‰

**æ§ä»¶ï¼ˆ5 ä¸ªï¼‰**ï¼š
- âœ… `Button` - å¯ç‚¹å‡»æŒ‰é’®
- âœ… `TextBlock` - æ–‡æœ¬æ˜¾ç¤ºï¼ˆ100%ï¼‰
- âœ… `Border` - è¾¹æ¡†å’ŒèƒŒæ™¯è£…é¥°å™¨ï¼ˆ120%ï¼‰
- âœ… `Image` - ä½å›¾å›¾åƒæ˜¾ç¤ºï¼ˆ100%ï¼‰
- âœ… `Window` - é¡¶çº§çª—å£

**å½¢çŠ¶ï¼ˆ3 ä¸ªï¼‰**ï¼š
- âš ï¸ `Shape` - çŸ¢é‡å½¢çŠ¶åŸºç±»ï¼ˆä»…å­˜æ ¹ï¼Œ0%ï¼‰
- âŒ `Rectangle` - çŸ©å½¢å½¢çŠ¶ï¼ˆæœªå®ç°ï¼‰
- âŒ `Ellipse` - æ¤­åœ†/åœ†å½¢å½¢çŠ¶ï¼ˆæœªå®ç°ï¼‰

**å˜æ¢ï¼ˆ7 ä¸ªï¼‰**ï¼š
- âœ… `Transform` - å˜æ¢åŸºç±»ï¼ˆ100%ï¼‰
- âœ… `TranslateTransform` - å¹³ç§»ï¼ˆ100%ï¼‰
- âœ… `ScaleTransform` - ç¼©æ”¾ï¼ˆ100%ï¼‰
- âœ… `RotateTransform` - æ—‹è½¬ï¼ˆ100%ï¼‰
- âœ… `SkewTransform` - å€¾æ–œï¼ˆ100%ï¼‰
- âœ… `MatrixTransform` - çŸ©é˜µå˜æ¢ï¼ˆ100%ï¼‰
- âœ… `TransformGroup` - ç»„åˆå˜æ¢ï¼ˆ100%ï¼‰

**æ ·å¼å’Œæ¨¡æ¿ï¼ˆ7 ä¸ªï¼‰**ï¼š
- âš ï¸ `Style` - æ ·å¼å®šä¹‰ï¼ˆ0% - æœªå®ç°ï¼‰
- âœ… `Setter` - å±æ€§è®¾ç½®å™¨
- ğŸ”§ `SetterCollection` - è®¾ç½®å™¨é›†åˆï¼ˆåŸºæœ¬å®ç°ï¼‰
- âš ï¸ `FrameworkTemplate` - æ¨¡æ¿åŸºç±»ï¼ˆä»…å­˜æ ¹ï¼‰
- âš ï¸ `ControlTemplate` - æ§ä»¶è§†è§‰æ¨¡æ¿ï¼ˆä»…å­˜æ ¹ï¼‰
- âš ï¸ `DataTemplate` - æ•°æ®å‘ˆç°æ¨¡æ¿ï¼ˆä»…å­˜æ ¹ï¼‰
- âœ… `ResourceDictionary` - èµ„æºå­˜å‚¨ï¼ˆ100%ï¼‰

**è¾“å…¥ç®¡ç†ï¼ˆ3 ä¸ªï¼‰**ï¼š
- âœ… `InputManager` - è¾“å…¥äº‹ä»¶è·¯ç”±å’Œå‘½ä¸­æµ‹è¯•ï¼ˆ98%ï¼‰
- âœ… `FocusManager` - é”®ç›˜ç„¦ç‚¹ç®¡ç†ï¼ˆ98%ï¼‰
- âœ… `RoutedEvent` - è·¯ç”±äº‹ä»¶ç³»ç»Ÿ

**é›†åˆï¼ˆ2 ä¸ªï¼‰**ï¼š
- âœ… `VisualCollection` - è§†è§‰å­å…ƒç´ é›†åˆï¼ˆ105%ï¼‰
- âœ… `ObservableCollection<T>` - å¸¦é€šçŸ¥çš„å¯è§‚å¯Ÿé›†åˆ

**æ¸²æŸ“ï¼ˆ1 ä¸ªï¼‰**ï¼š
- âœ… `DrawCommand` - ç»˜å›¾å‘½ä»¤ç»“æ„ï¼ˆ110%ï¼‰

**åŸºæœ¬ç±»å‹å’Œç±»å‹ï¼ˆ6 ä¸ªï¼‰**ï¼š
- âœ… `Primitives` - Pointã€Sizeã€Rectã€Matrix3x2ã€Color
- âœ… `Thickness` - å››è¾¹åšåº¦
- âœ… `CornerRadius` - åœ†è§’åŠå¾„è§„èŒƒ
- âœ… `Enums` - Visibilityã€Orientationã€Alignment æšä¸¾
- âœ… `TextEnums` - æ–‡æœ¬ç‰¹å®šæšä¸¾
- âœ… `Alignment` - å¯¹é½æšä¸¾

**èŒè´£**ï¼š
- è§†è§‰æ ‘æ„å»ºå’Œç®¡ç†
- å¸ƒå±€ï¼ˆæµ‹é‡å’Œæ’åˆ—ï¼‰
- è¾“å…¥äº‹ä»¶å¤„ç†å’Œè·¯ç”±
- é€šè¿‡ DrawCommands æ¸²æŸ“
- æ§ä»¶æ¨¡æ¿åŒ–å’Œæ ·å¼åŒ–
- ç„¦ç‚¹å’Œé”®ç›˜å¯¼èˆª

**å…³é”®ä¾èµ–**ï¼šBinding (DependencyObject, å±æ€§)ã€Core (Event, Dispatcher)ã€Render (DrawCommand)

---

## å…³é”®è®¾è®¡æ¨¡å¼

### 1. ä¾èµ–å±æ€§ç³»ç»Ÿ

**æ¨¡å¼**ï¼šå¸¦å…ƒæ•°æ®çš„é™„åŠ è¡Œä¸º

**å®ç°**ï¼š
```
DependencyObject
    â””â”€â”€ PropertyStore (æ˜ å°„ DependencyProperty -> å€¼)
    â””â”€â”€ BindingContext (æ˜ å°„ DependencyProperty -> BindingExpression)

DependencyProperty
    â””â”€â”€ PropertyMetadata (é»˜è®¤å€¼ã€å›è°ƒã€å¼ºåˆ¶è½¬æ¢)
```

**æµç¨‹**ï¼š
1. ä½¿ç”¨å…ƒæ•°æ®æ³¨å†Œå±æ€§
2. å€¼å­˜å‚¨åœ¨ PropertyStore ä¸­
3. å˜æ›´è§¦å‘å›è°ƒå’Œäº‹ä»¶
4. ç»‘å®šåœ¨å˜æ›´æ—¶è‡ªåŠ¨æ›´æ–°

### 2. è§†è§‰æ ‘ / é€»è¾‘æ ‘

**æ¨¡å¼**ï¼šå…·æœ‰åŒå±‚æ¬¡ç»“æ„çš„ç»„åˆ

**è§†è§‰æ ‘**ï¼šæ¸²æŸ“å’Œå‘½ä¸­æµ‹è¯•
```
Visual
    â””â”€â”€ children_: vector<Visual*>
    â””â”€â”€ parent_: Visual*
```

**é€»è¾‘æ ‘**ï¼šDataContext ç»§æ‰¿å’Œå…ƒç´ æŸ¥æ‰¾
```
DependencyObject
    â””â”€â”€ logicalChildren_: vector<DependencyObject*>
    â””â”€â”€ logicalParent_: DependencyObject*
```

### 3. æ•°æ®ç»‘å®š

**æ¨¡å¼**ï¼šå…·æœ‰åŒå‘ä¼ æ’­çš„è§‚å¯Ÿè€…

**ç»„ä»¶**ï¼š
```
Source (ViewModel)
    â””â”€â”€ INotifyPropertyChanged
    
Binding Configuration
    â””â”€â”€ Source, Path, Mode, Converter

BindingExpression (Active)
    â””â”€â”€ è®¢é˜…æºå˜æ›´
    â””â”€â”€ æ›´æ–°ç›®æ ‡å±æ€§
    â””â”€â”€ åœ¨ TwoWay æ—¶æ›´æ–°æº
```

**æµç¨‹**ï¼š
1. ä½¿ç”¨ source/path åˆ›å»ºç»‘å®š
2. BindingExpression è§£ææºå¯¹è±¡
3. è®¢é˜… PropertyChanged
4. æ ¹æ® BindingMode æ›´æ–°æµ

### 4. CRTP ç”¨äºç±»å‹å®‰å…¨æ´¾ç”Ÿ

**æ¨¡å¼**ï¼šå¥½å¥‡çš„é€’å½’æ¨¡æ¿æ¨¡å¼

**ç¤ºä¾‹**ï¼š
```cpp
template<typename Derived>
class FrameworkElement : public UIElement {
    Derived* This() { return static_cast<Derived*>(this); }
};

class Button : public ContentControl<Button> {
    // é€šè¿‡ CRTP ç»§æ‰¿ç±»å‹å®‰å…¨æ–¹æ³•
};
```

**ä¼˜ç‚¹**ï¼š
- ç¼–è¯‘æ—¶å¤šæ€
- æ²¡æœ‰ vtable å¼€é”€
- ç±»å‹å®‰å…¨çš„æ–¹æ³•é“¾

### 5. æ¨¡æ¿ç³»ç»Ÿ

**æ¨¡å¼**ï¼šå…·æœ‰å»¶è¿Ÿå®ä¾‹åŒ–çš„ç­–ç•¥

```
Control
    â””â”€â”€ Template: ControlTemplate

ControlTemplate
    â””â”€â”€ VisualTreeFactory: function

åº”ç”¨æ¨¡æ¿ï¼š
    1. è°ƒç”¨ VisualTreeFactory
    2. è®¾ç½®ä¸ºè§†è§‰å­å…ƒç´ 
    3. åº”ç”¨ TemplateBindings
```

### 6. è·¯ç”±äº‹ä»¶

**æ¨¡å¼**ï¼šäº‹ä»¶å†’æ³¡å’Œéš§é“

**æµç¨‹**ï¼š
```
ç›®æ ‡å…ƒç´  (ç›´æ¥)
    â†“ éš§é“ (PreviewXxx)
æ ¹ â†’ çˆ¶ â†’ ... â†’ ç›®æ ‡
    â†‘ å†’æ³¡ (Xxx)
ç›®æ ‡ â†’ ... â†’ çˆ¶ â†’ æ ¹
```

### 7. å¸ƒå±€ç³»ç»Ÿ

**æ¨¡å¼**ï¼šä¸¤éåŸºäºçº¦æŸçš„å¸ƒå±€

**æµ‹é‡é**ï¼šè®¡ç®—æœŸæœ›å¤§å°
```
Parent.Measure(availableSize)
    â†’ Child.Measure(childConstraint)
        â†’ Child.DesiredSize
```

**æ’åˆ—é**ï¼šå®šä½å…ƒç´ 
```
Parent.Arrange(finalRect)
    â†’ Child.Arrange(childRect)
        â†’ Child.RenderSize
```

## æ•°æ®æµå›¾

### ç»‘å®šæ›´æ–°æµ

```
ViewModel å±æ€§å˜æ›´
    â†“
INotifyPropertyChanged.PropertyChanged
    â†“
BindingExpression æ¥æ”¶é€šçŸ¥
    â†“
BindingExpression.UpdateTarget()
    â†“
DependencyObject.SetValue() [ç»‘å®šæº]
    â†“
PropertyStore æ›´æ–°å€¼
    â†“
DependencyObject.PropertyChanged äº‹ä»¶
    â†“
UIElement.InvalidateVisual()
    â†“
é‡æ–°æ¸²æŸ“
```

### è¾“å…¥äº‹ä»¶æµ

```
å¹³å°è¾“å…¥ (é¼ æ ‡/é”®ç›˜)
    â†“
RenderBackend æ•è·äº‹ä»¶
    â†“
InputManager.ProcessInput()
    â†“
å‘½ä¸­æµ‹è¯• (å¸¦å˜æ¢)
    â†“
æŸ¥æ‰¾ç›®æ ‡ UIElement
    â†“
å¼•å‘è·¯ç”±äº‹ä»¶ (Preview + Bubble)
    â†“
å…ƒç´ äº‹ä»¶å¤„ç†ç¨‹åº
    â†“
å¦‚éœ€è¦æ›´æ–°è§†è§‰çŠ¶æ€
```

### æ¸²æŸ“ç®¡çº¿

```
è§†è§‰æ ‘
    â†“
å¸ƒå±€é (Measure + Arrange)
    â†“
RenderTreeBuilder éå†
    â†“
ç”Ÿæˆ DrawCommands
    â†“
RenderCommandBuffer
    â†“
GlRenderer å¤„ç†å‘½ä»¤
    â†“
OpenGL ç»˜åˆ¶è°ƒç”¨
    â†“
å¸§ç¼“å†² â†’ å±å¹•
```

## çº¿ç¨‹æ¨¡å‹

### UI çº¿ç¨‹å…³è”

æ‰€æœ‰ UI å¯¹è±¡éƒ½æ˜¯å•çº¿ç¨‹çš„ï¼Œå¿…é¡»ä»…ä» UI çº¿ç¨‹è®¿é—®ã€‚

```
åå°çº¿ç¨‹
    â†“
Dispatcher.InvokeAsync(action)
    â†“
æ¶ˆæ¯é˜Ÿåˆ—
    â†“
UI çº¿ç¨‹å¤„ç†æ“ä½œ
    â†“
å®‰å…¨è®¿é—® UI å¯¹è±¡
```

### Dispatcher æ“ä½œ

```cpp
// ä»åå°çº¿ç¨‹
std::thread([dispatcher, element]() {
    // åšå·¥ä½œ...
    
    dispatcher->InvokeAsync([element]() {
        // æ›´æ–° UIï¼ˆç°åœ¨åœ¨ UI çº¿ç¨‹ä¸Šï¼‰
        element->SetValue(Property, value);
    });
}).detach();
```

## å†…å­˜ç®¡ç†ç­–ç•¥

### æ‰€æœ‰æƒè§„åˆ™

1. **è§†è§‰æ ‘**ï¼šçˆ¶ä¸æ‹¥æœ‰å­ï¼ˆå¼±å¼•ç”¨ï¼‰
2. **é€»è¾‘æ ‘**ï¼šçˆ¶ä¸æ‹¥æœ‰å­ï¼ˆå¼±å¼•ç”¨ï¼‰
3. **å…±äº«æ‰€æœ‰æƒ**ï¼šå…¬å…± API ä½¿ç”¨ `shared_ptr`
4. **ç»‘å®š**ï¼šBindingContext æ‹¥æœ‰ BindingExpressions
5. **äº‹ä»¶è¿æ¥**ï¼šè¿æ¥å¯¹è±¡ç®¡ç†ç”Ÿå‘½å‘¨æœŸ

### ç”Ÿå‘½å‘¨æœŸ

```
Application æ‹¥æœ‰ Windows
Windows æŒæœ‰å¯¹æ ¹å†…å®¹çš„ shared_ptr
å†…å®¹æŒæœ‰å¯¹å­å…ƒç´ çš„ shared_ptr
ç»‘å®šåœ¨æ´»åŠ¨æ—¶ä¿æŒæºå­˜æ´»
äº‹ä»¶è¿æ¥åœ¨é”€æ¯æ—¶è‡ªåŠ¨æ–­å¼€
```

## æ€§èƒ½ç‰¹å¾

### å±æ€§è®¿é—®
- Getï¼šO(1) å“ˆå¸ŒæŸ¥æ‰¾
- Setï¼šO(1) + é€šçŸ¥å¼€é”€
- Bindingï¼šé¢å¤–çš„æºè§£æ

### å¸ƒå±€
- Measureï¼šO(n)ï¼Œå…¶ä¸­ n = å…ƒç´ æ•°
- Arrangeï¼šO(n)
- å¤±æ•ˆï¼šO(1) æ ‡å¿—è®¾ç½®ï¼Œå»¶è¿Ÿé‡æ–°è®¡ç®—

### æ¸²æŸ“
- æ„å»ºæ¸²æŸ“æ ‘ï¼šO(n)
- ç»˜åˆ¶å‘½ä»¤ï¼šO(n)
- OpenGL è°ƒç”¨ï¼šå°½å¯èƒ½æ‰¹å¤„ç†

### å†…å­˜å ç”¨
- DependencyObjectï¼š~200 å­—èŠ‚
- UIElementï¼š+~100 å­—èŠ‚
- Controlï¼š+~50 å­—èŠ‚
- æ¯ä¸ªç»‘å®šï¼š~100 å­—èŠ‚

## æ‰©å±•ç‚¹

### è‡ªå®šä¹‰æ§ä»¶
1. ç»§æ‰¿ `Control<MyControl>`
2. é‡å†™ `OnRender()` è¿›è¡Œè‡ªå®šä¹‰ç»˜åˆ¶
3. å¦‚éœ€è¦é‡å†™å¸ƒå±€æ–¹æ³•
4. å®šä¹‰ä¾èµ–å±æ€§

### è‡ªå®šä¹‰é¢æ¿
1. ç»§æ‰¿ `Panel<MyPanel>`
2. é‡å†™ `MeasureOverride()`
3. é‡å†™ `ArrangeOverride()`

### è‡ªå®šä¹‰ç»‘å®šè½¬æ¢å™¨
1. å®ç° `IValueConverter`
2. å®ç° `Convert()` å’Œ `ConvertBack()`

### è‡ªå®šä¹‰éªŒè¯
1. ç»§æ‰¿ `ValidationRule`
2. é‡å†™ `Validate()`

## æœªæ¥æ¶æ„å¢å¼º

1. **åŠ¨ç”»ç³»ç»Ÿ**ï¼šåŸºäºæ—¶é—´è½´çš„å±æ€§åŠ¨ç”»
2. **åˆæˆå±‚**ï¼šç¦»çº¿ç¨‹æ¸²æŸ“å’ŒåŠ¨ç”»
3. **èµ„æºç®¡ç†**ï¼šçº¹ç†å›¾é›†ã€ç€è‰²å™¨ç¼–è¯‘
4. **å¯è®¿é—®æ€§**ï¼šå±å¹•é˜…è¯»å™¨æ”¯æŒã€é”®ç›˜å¯¼èˆª
5. **è§¦æ‘¸è¾“å…¥**ï¼šæ‰‹åŠ¿è¯†åˆ«ã€å¤šç‚¹è§¦æ§
6. **3D æ”¯æŒ**ï¼š3D å˜æ¢å’Œç›¸æœº
7. **ç¡¬ä»¶åŠ é€Ÿ**ï¼šGPU åŠ é€Ÿæ•ˆæœ

## å¦è¯·å‚é˜…

- [å…¥é—¨æŒ‡å—](GettingStarted.md)
- [å¼€å‘æŒ‡å—](Development.md)
- [API å‚è€ƒ](API/README.md)
- [å®ç°çŠ¶æ€](Implementation-Status.md)
