# UI框架的最初设计

我们采用C++23标准进行UI框架的设计，参考了WPF、WINUI和QT等成熟框架的设计理念。以下是UI框架最初设计的核心组件和类结构。
框架的头文件按照职责划分在`fk/core`、`fk/ui`和`fk/app`等子目录中，使用时按需包含对应路径。
绘制引擎方面，我们计划使用OpenGL作为底层渲染API，以确保高性能和跨平台兼容性。

## 1. 系统组件

在最初的设计中，UI框架的核心组件是Application和Window。Application负责管理应用程序的生命周期，而Window则代表应用程序中的一个窗口。每个Application可以包含多个Window，每个Window可以包含多个视图组件。

### 1.1 Application
Application类负责初始化应用程序环境，处理应用程序的启动和关闭事件。它还负责管理全局资源，如主题、字体和颜色等。

#### 属性
- `Windows`: 获取应用程序中所有窗口的集合。
- `Current`: 获取当前应用程序实例的静态属性。
- `IsRunning`: 获取一个值，指示应用程序是否正在运行。
- `Exit`: 获取一个事件，当应用程序即将关闭时引发该事件。
- `Startup`: 获取一个事件，当应用程序启动时引发该事件。
- `Activated`: 获取一个事件，当应用程序激活时引发该事件。
- `Deactivated`: 获取一个事件，当应用程序失去激活时引发该事件。

#### 方法
- `Run()`: 启动应用程序的主事件循环。
- `Shutdown()`: 关闭应用程序并释放所有资源。
- `AddWindow(WindowPtr window, std::string name)`: 向应用程序添加一个新的窗口并为其命名。
- `RemoveWindow(WindowPtr window)`: 从应用程序中移除指定窗口实例。
- `RemoveWindow(std::string name)`: 从应用程序中移除指定名称的窗口。

#### 事件
- `Exit`: 当应用程序即将关闭时引发该事件。
- `Startup`: 当应用程序启动时引发该事件。
- `Activated`: 当应用程序激活时引发该事件。
- `Deactivated`: 当应用程序失去激活时引发该事件。

事件支持通过`Connect`方法注册处理程序并返回`fk::core::Event<>::Connection`对象，这些连接在析构时会自动断开，便于以RAII方式管理订阅。

#### 例子
```cpp
#include <iostream>
#include "fk/app/Application.h"
#include "fk/ui/Window.h"

class App : public fk::Application {
public:
    App() {
        startupConnection_ = this->Startup.Connect([]() {
            std::cout << "Application started!" << std::endl;
        });

        exitConnection_ = this->Exit.Connect([]() {
            std::cout << "Application exiting!" << std::endl;
        });
    }

private:
    fk::core::Event<>::Connection startupConnection_;
    fk::core::Event<>::Connection exitConnection_;
};

int main() {
    App app;

    auto mainWindow = fk::Window::Create();
    app.AddWindow(mainWindow, "MainWindow");

    app.Run();

    return 0;
}
```


### 1.2 Window
Window类代表应用程序中的一个窗口。它负责处理窗口的创建、显示和销毁。Window还负责管理窗口中的视图组件，并处理用户输入事件。

#### 属性
- `Title`: 获取或设置窗口的标题。
- `Width`: 获取或设置窗口的宽度。
- `Height`: 获取或设置窗口的高度。
- `IsVisible`: 获取一个值，指示窗口是否可见。
- `Content`: 获取或设置窗口的内容视图。
- `Closed`: 获取一个事件，当窗口关闭时引发该事件。
- `Activated`: 获取一个事件，当窗口激活时引发该事件。
- `Deactivated`: 获取一个事件，当窗口失去激活时引发该事件。
- `Resized`: 获取一个事件，当窗口大小改变时引发该事件。
- `Moved`: 获取一个事件，当窗口位置改变时引发该事件。
- `KeyDown`: 获取一个事件，当按下键盘按键时引发该事件。
- `KeyUp`: 获取一个事件，当释放键盘按键时引发该事件。
- `MouseDown`: 获取一个事件，当按下鼠标按钮时引发该事件。
- `MouseUp`: 获取一个事件，当释放鼠标按钮时引发该事件。
- `MouseMove`: 获取一个事件，当鼠标移动时引发该事件。
- `MouseWheel`: 获取一个事件，当鼠标滚轮滚动时引发该事件。
- `FocusGained`: 获取一个事件，当窗口获得焦点时引发该事件。
- `FocusLost`: 获取一个事件，当窗口失去焦点时引发该事件。
- `Closing`: 获取一个事件，当窗口即将关闭时引发该事件。
- `Opened`: 获取一个事件，当窗口打开时引发该事件。
- `Minimized`: 获取一个事件，当窗口最小化时引发该事件。
- `Maximized`: 获取一个事件，当窗口最大化时引发该事件。
- `Restored`: 获取一个事件，当窗口从最小化或最大化恢复时引发该事件。

#### 方法
- `Show()`: 显示窗口。
- `Hide()`: 隐藏窗口。
- `Close()`: 关闭窗口。
- `Content(View content)`: 设置窗口的内容视图。
- `Content()`: 获取窗口的内容视图。
- `Focus()`: 使窗口获得焦点。
- `Resize(int width, int height)`: 调整窗口大小。
- `Move(int x, int y)`: 移动窗口位置。
- `Minimize()`: 最小化窗口。
- `Maximize()`: 最大化窗口。
- `Restore()`: 还原窗口。
- `Title(std::string title)`: 设置窗口标题。
- `Title()`: 获取窗口标题。
- `Width(int width)`: 设置窗口宽度。
- `Width()`: 获取窗口宽度。
- `Height(int height)`: 设置窗口高度。
- `Height()`: 获取窗口高度。
- `IsVisible(bool isVisible)`: 设置窗口可见性。
- `IsVisible()`: 获取窗口可见性。

#### 事件
- `Closed`: 当窗口关闭时引发该事件。
- `Activated`: 当窗口激活时引发该事件。
- `Deactivated`: 当窗口失去激活时引发该事件。
- `Resized`: 当窗口大小改变时引发该事件。
- `Moved`: 当窗口位置改变时引发该事件。
- `KeyDown`: 当按下键盘按键时引发该事件。
- `KeyUp`: 当释放键盘按键时引发该事件。
- `MouseDown`: 当按下鼠标按钮时引发该事件。
- `MouseUp`: 当释放鼠标按钮时引发该事件。
- `MouseMove`: 当鼠标移动时引发该事件。
- `MouseWheel`: 当鼠标滚轮滚动时引发该事件。
- `FocusGained`: 当窗口获得焦点时引发该事件。
- `FocusLost`: 当窗口失去焦点时引发该事件。
- `Closing`: 当窗口即将关闭时引发该事件。
- `Opened`: 当窗口打开时引发该事件。
- `Minimized`: 当窗口最小化时引发该事件。
- `Maximized`: 当窗口最大化时引发该事件。
- `Restored`: 当窗口从最小化或最大化恢复时引发该事件。

与`Application`一致，窗口事件同样可以通过`Connect`获取自动断开的连接句柄，以避免手动管理订阅释放。

#### 例子
```cpp
#include <iostream>
#include <memory>
#include "fk/app/Application.h"
#include "fk/ui/Window.h"

class App : public fk::Application {
public:
    App() {
        this->Startup += []() {
            std::cout << "Application started!" << std::endl;
        };

        this->Exit += []() {
            std::cout << "Application exiting!" << std::endl;
        };
    }
        this->Exit += []() {
            std::cout << "Application exiting!" << std::endl;
        };
    }
};

class Mainwindow : public fk::Window {
public:
    Mainwindow() {
        this->Title("Main Window");
        this->Width(800);
        this->Height(600);

        this->Closed += []() {
            std::cout << "Window closed!" << std::endl;
        };

        this->Resized += [](int width, int height) {
            std::cout << "Window resized to " << width << "x" << height << std::endl;
        };
    }
};

int main() {
    App app;

    auto mainWindow = std::make_shared<Mainwindow>();
    app.AddWindow(mainWindow, "MainWindow");

    app.Run();

    return 0;
}
```

## 2. 视图组件

视图组件是UI框架中的基本构建块，用于构建用户界面。每个视图组件都继承自基类View，并可以包含其他视图组件作为子组件。视图组件负责处理自身的渲染和用户交互事件。

### 2.1 基类

#### 2.1.1 View
View类是所有视图组件的基类，提供了基本的属性和方法，用于管理视图的布局、渲染和事件处理。

采用模板类设计，以支持不同类型的视图组件，使派生类的属性方法能够返回正确的派生类型，从而实现链式调用。

##### 属性
- `Width`: 获取或设置视图的宽度。
- `Height`: 获取或设置视图的高度。
- `IsVisible`: 获取或设置视图的可见性。
- `Margin`: 获取或设置视图的外边距。
- `Padding`: 获取或设置视图的内边距。
- `Background`: 获取或设置视图的背景颜色。

##### 方法
- `Render()`: 渲染视图组件。
- `Measure(int availableWidth, int availableHeight)`: 测量视图组件的大小。
- `Arrange(int x, int y, int width, int height)`: 布局视图组件的位置和大小。
- `Width(int width)`: 设置视图宽度。
- `Width()`: 获取视图宽度。
- `Height(int height)`: 设置视图高度。
- `Height()`: 获取视图高度。
- `IsVisible(bool isVisible)`: 设置视图可见性。
- `IsVisible()`: 获取视图可见性。
- `Margin(Thickness margin)`: 设置视图外边距。
- `Margin()`: 获取视图外边距。
- `Padding(Thickness padding)`: 设置视图内边距。
- `Padding()`: 获取视图内边距。

#### 2.1.2 Control
Control类是所有可交互视图组件的基类，继承自View，添加了处理用户输入事件的功能。
##### 属性
- `IsEnabled`: 获取或设置控件是否可用。
- `IsFocused`: 获取控件是否获得焦点。
- `TabIndex`: 获取或设置控件在Tab顺序中的索引。
- `Cursor`: 获取或设置控件的鼠标光标样式。
- `Content`: 获取或设置控件的内容。

##### 方法
- `Focus()`: 使控件获得焦点。
- `Blur()`: 使控件失去焦点。
- `OnClick()`: 处理控件的点击事件。
- `OnKeyDown()`: 处理控件的键盘按下事件。
- `OnKeyUp()`: 处理控件的键盘释放事件。
- `OnMouseDown()`: 处理控件的鼠标按下事件。
- `OnMouseUp()`: 处理控件的鼠标释放事件。
- `OnMouseMove()`: 处理控件的鼠标移动事件。
- `OnMouseWheel()`: 处理控件的鼠标滚轮事件。

#### 2.1.3 Panel
Panel类是用于布局子视图组件的容器，继承自View。它提供了多种布局方式，如堆叠布局、网格布局等，用于组织和排列子视图组件。

##### 属性
- `Children`: 获取面板中的子视图组件集合。

##### 方法
- `AddChild(ViewPtr child)`: 向面板添加一个子视图组件。
- `RemoveChild(ViewPtr child)`: 从面板中移除一个子视图组件。
- `ClearChildren()`: 移除面板中的所有子视图组件。
- `Children()`: 获取面板中的所有子视图组件集合。
- `Children(std::vector<ViewPtr> children)`: 设置面板中的子视图组件集合。
- `Layout()`: 布局面板中的子视图组件。

